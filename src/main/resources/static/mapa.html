<!DOCTYPE html>
<html lang="en">
<head>
    <title>Mapa en Tiempo Real</title>
    <meta charset="utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
<h2>Ubicaci√≥n en tiempo real</h2>
<div id="map" style="height: 500px;"></div>

<script>
    var map = L.map('map').setView([-12.0464, -77.0428], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    var marker = L.marker([-12.0464, -77.0428]).addTo(map);

    var socket = new SockJS('/ws-ubicacion');
    var stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        stompClient.subscribe('/ubicacion/actual', function (ubicacion) {
            var data = JSON.parse(ubicacion.body);
            marker.setLatLng([data.latitud, data.longitud]);
            map.panTo([data.latitud, data.longitud]);
        });
    });
</script>

<button onclick="iniciarSimulacion()">Iniciar Simulaci√≥n</button>
<button onclick="detenerSimulacion()">Detener Simulaci√≥n</button>
<script>
    function iniciarSimulacion() {
        fetch('/simulador/iniciar', { method: 'POST' })
            .then(() => alert("‚úÖ Simulaci√≥n iniciada"))
            .catch(() => alert("‚ùå Error al iniciar la simulaci√≥n"))
        ;
    }

    function detenerSimulacion() {
        fetch('/simulador/detener', { method: 'POST' })
            .then(() => alert("üõë Simulaci√≥n detenida"))
            .catch(() => alert("‚ùå Error al detener la simulaci√≥n"))
        ;
    }
</script>

</body>
</html>
